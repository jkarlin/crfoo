
<p>Number of Worklets Created: <span id="numWorkletsCreated">0</span></p>
<p>Number of Errors: <span id="numErrors">0</span></p>

<script>

let numWorkletsCreated = 0;
let numErrors = 0;

function incrementNumWorkletsCreated() {
  numWorkletsCreated++;
  document.getElementById("numWorkletsCreated").textContent = numWorkletsCreated;
}

function incrementNumErrors() {
  numErrors++;
  document.getElementById("numErrors").textContent = numErrors;
}
  
async function createAndRunWorklet(url) {
  try {
    let worklet = await sharedStorage.createWorklet(url, {dataOrigin: "script-origin"});
    incrementNumWorkletsCreated();
    worklet.run('go', {keepAlive: true});
  } catch (error) {
    incrementNumErrors();
  }
}

const urlString = window.location.search; // Gets the query string part of the URL
const searchParams = new URLSearchParams(urlString);
let count = 10;
if (searchParams.has('count')) {
  count = searchParams.get('count');
}

for (let i = 0; i < count; i++) {
  let url = "https://" + (i % 2 == 0 ? "cr" : "cr2") + ".kungfoo.net/jkarlin/createWorkletMulti/worklet.js";
  createAndRunWorklet(url);
}

// function refreshPage() {
//   setTimeout(function() {
//     location.reload();
//   }, 0);
// }

// window.onload = refreshPage();
  
</script>
